# 商品模块文档

## 第一部分：总体逻辑

商品模块主要负责商品展示和详情功能，包括以下核心功能：

1. **商品列表**：
   - 商品分类展示
   - 商品搜索
   - 商品排序与筛选
   - 分页加载

2. **商品详情**：
   - 商品基本信息展示
   - 规格选择
   - 商品评价
   - 商品参数
   - 相关推荐

3. **商品交互**：
   - 添加购物车
   - 立即购买
   - 收藏商品
   - 分享商品

### 流程图：商品模块总体逻辑

```
┌───────────────────┐     ┌───────────────────┐     ┌───────────────────┐
│                   │     │                   │     │                   │
│    商品列表        │     │    商品详情        │     │    商品交互        │
│                   │     │                   │     │                   │
└─────────┬─────────┘     └─────────┬─────────┘     └─────────┬─────────┘
          │                         │                         │
          ▼                         ▼                         ▼
┌───────────────────┐     ┌───────────────────┐     ┌───────────────────┐
│ - 分类展示        │     │ - 基本信息        │     │ - 添加购物车      │
│ - 搜索商品        │     │ - 规格选择        │     │ - 立即购买        │
│ - 排序与筛选      │     │ - 商品评价        │     │ - 收藏商品        │
│ - 分页加载        │     │ - 商品参数        │     │ - 分享商品        │
│                   │     │ - 相关推荐        │     │                   │
└───────────────────┘     └───────────────────┘     └───────────────────┘
```

## 第二部分：组件到Store的逻辑

商品模块采用Vue3的组合式API和Pinia状态管理库，实现组件与状态管理的解耦。

### 核心组件

1. **GoodsList.vue**：
   - 商品列表页面组件
   - 包含搜索、分类、筛选功能
   - 实现商品列表展示和分页
   - 支持多种排序方式

2. **GoodsDetail.vue**：
   - 商品详情页面组件
   - 包含商品信息、规格选择
   - 显示评价、参数等详细信息
   - 提供加入购物车、立即购买等功能

### 状态管理 (useGoodsStore.js)

状态管理器封装了所有商品相关操作，包括：

- 商品列表数据管理
- 商品详情数据管理
- 搜索条件管理
- 筛选与排序状态管理

### 核心状态和计算属性

- **状态**：
  - `goodsList`: 商品列表数据
  - `goodsDetail`: 当前商品详情
  - `searchParams`: 搜索参数
  - `pagination`: 分页信息
  - `sortOption`: 排序选项
  - `filterOptions`: 筛选选项

- **计算属性**：
  - `displayGoods`: 当前显示的商品列表
  - `hasNextPage`: 是否有下一页
  - `selectedSpecs`: 已选规格组合

### 数据流向

组件通过Pinia的useGoodsStore获取状态和方法，Store通过API服务与后端交互。

### 流程图：组件到Store的数据流

```
┌───────────────────────────────────────────┐
│                                           │
│              视图层 (View)                 │
│                                           │
├───────────────┬───────────────────────────┤
│               │                           │
│  GoodsList    │       GoodsDetail         │
│               │                           │
└───────┬───────┴─────────────┬─────────────┘
        │                     │
        │                     │
        ▼                     ▼
┌───────────────────────────────────────────┐
│                                           │
│         状态管理 (useGoodsStore)           │
│                                           │
├─────────────────┬─────────────────────────┤
│                 │                         │
│     状态        │          方法           │
│                 │                         │
├─────────────────┼─────────────────────────┤
│ - goodsList     │ - fetchGoodsList()      │
│ - goodsDetail   │ - fetchGoodsDetail()    │
│ - searchParams  │ - searchGoods()         │
│ - pagination    │ - setFilter()           │
│ - sortOption    │ - setSortOption()       │
│ - filterOptions │ - loadNextPage()        │
│                 │ - addToCart()           │
│                 │ - buyNow()              │
│                 │                         │
└─────────────────┴──────────┬──────────────┘
                             │
                             │
                             ▼
┌────────────────────────────────────────────┐
│                                            │
│                  API 层                     │
│                                            │
└────────────────────────────────────────────┘
```

## 第三部分：API层

商品模块的API分为两个主要文件：

1. **goods.js**：处理商品列表和详情相关API
2. **search.js**：处理商品搜索相关API

### API架构

所有API请求都通过 `request.js` 工具函数封装，统一处理以下功能：
- 请求拦截：添加必要参数
- 响应拦截：统一错误处理
- Mock数据支持：开发环境使用Mock数据

### 真实API与Mock数据

项目同时支持真实API和Mock数据：
- 开发环境默认使用Mock数据
- 通过在请求中设置 `mock: true/false` 可以控制是否使用Mock数据

### Mock实现

- Mock数据实现了所有API的模拟响应
- 在 `src/mock/modules/goods.mock.js` 中定义了所有商品相关的Mock数据
- 支持模拟真实场景，如商品列表分页、搜索过滤、规格选择等

### 流程图：API调用与Mock处理流程

```
┌────────────────┐      ┌────────────────┐      ┌────────────────┐
│                │      │                │      │                │
│  组件/Store    │      │   请求工具     │      │   API服务器    │
│                │      │  request.js    │      │  或Mock服务    │
│                │      │                │      │                │
└────────┬───────┘      └────────┬───────┘      └────────┬───────┘
         │                       │                       │
         │  调用API服务          │                       │
         ├───────────────────────►                       │
         │                       │                       │
         │                       │ 判断是否使用Mock      │
         │                       ├─────────┐             │
         │                       │         │             │
         │                       │ ◄───────┘             │
         │                       │                       │
         │                       │ 如使用真实API         │
         │                       ├───────────────────────►
         │                       │                       │
         │                       │ 如使用Mock            │
         │                       │                       │
         │                       │ ┌──────────────────┐  │
         │                       │ │                  │  │
         │                       │ │  拦截原始请求    │  │
         │                       │ │                  │  │
         │                       │ └─────────┬────────┘  │
         │                       │           │           │
         │                       │           ▼           │
         │                       │ ┌──────────────────┐  │
         │                       │ │                  │  │
         │                       │ │ 处理Mock数据响应 │  │
         │                       │ │                  │  │
         │                       │ └─────────┬────────┘  │
         │                       │           │           │
         │                       │ ◄─────────┘           │
         │                       │                       │
         │  响应结果             │                       │
         ◄───────────────────────┤                       │
         │                       │                       │
         │                       │                       │
┌────────┴───────┐      ┌────────┴───────┐      ┌────────┴───────┐
│                │      │                │      │                │
│  组件/Store    │      │   请求工具     │      │   API服务器    │
│  处理响应      │      │  request.js    │      │  或Mock服务    │
│                │      │                │      │                │
└────────────────┘      └────────────────┘      └────────────────┘
```

## 核心API列表

### 商品API (goods.js)
- `fetchGoodsList(params)` - 获取商品列表
- `fetchGoodsDetail(id)` - 获取商品详情
- `fetchGoodsRecommend(id)` - 获取相关推荐商品
- `fetchGoodsComments(id, params)` - 获取商品评价

### 搜索API (search.js)
- `searchGoods(keyword, params)` - 搜索商品
- `fetchHotSearch()` - 获取热门搜索关键词
- `fetchSearchSuggestions(keyword)` - 获取搜索建议 